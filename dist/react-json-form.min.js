!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).reactJsonForm=t()}(this,function(){function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(a=i[n])>=0||(r[a]=e[a]);return r}function r(e){var t={};for(var a in e.keys){var n=e.keys[a],l=n.type;if("array"===l)t[a]=i(n);else if("object"===l)t[a]=r(n);else if("string"===l)t[a]="";else if("number"===e.type)return""}return t}function i(e){var t=[],a=e.items.type;return"array"===a?t.push(i(e.items)):"object"===a?t.push(r(e.items)):("string"===a||"number"===e.type)&&t.push(""),t}function l(e){return"array"===e.type?i(e):"object"===e.type?r(e):"string"===e.type||"number"===e.type?"":void 0}function o(e,t){for(var a=JSON.parse(JSON.stringify(e)),n=0;n<e.length;n++){var r=e[n];"array"===t.items.type?a[n]=o(r,t.items):"object"===t.items.type&&(a[n]=s(r,t.items))}return a}function s(e,t){for(var a=JSON.parse(JSON.stringify(e)),n=[].concat(Object.keys(t.keys)),r=0;r<n.length;r++){var i=n[r],l=t.keys[i];e.hasOwnProperty(i)?"string"===l.type?a[i]=e[i]:"array"===l.type?a[i]=o(e[i],l):"object"===l.type&&(a[i]=s(e[i],l)):"string"===l.type?a[i]="":"array"===l.type?a[i]=o([],l):"object"===l.type&&(a[i]=s({},l))}return a}var u=["className"];function c(t){var a=t.className,r=n(t,u);return a||(a=""),a="rjf-"+a+"-button",h("button",e({className:a,type:"button"},r),r.children)}function p(e){return h("div",{className:"rjf-loader"})}var d=React.createContext(),f=["label","help_text","error","inputRef"],m=["label","help_text","error","value"],v=["label","help_text","error","value","options"],y=["label","help_text","error","value","options"],g=["label","value"];function b(e){var t=e.label,a=e.inputRef,r=n(e,f);return"string"===r.type&&(r.type="text"),a&&(r.ref=a),h("div",null,t&&h("label",null,t),h("input",r))}function N(e){var t=e.label,a=e.value,r=n(e,m);return t||(t=r.name.toUpperCase()),"bool"===r.type&&(r.type="checkbox"),void 0===r.checked&&(r.checked=a),""===r.checked&&(r.checked=!1),h("div",null,h("label",null,h("input",r)," ",t))}function k(t){var a=t.label,r=t.value,i=t.options,l=n(t,v);return h("div",null,h("label",null,a),i.map(function(t,a){var n,i;return"object"==typeof t?(n=t.label,i=t.value):(n=t,i=t),h("label",{key:n+"_"+i+"_"+a},h("input",e({},l,{value:i,checked:i===r}))," ",n)}))}function j(t){var a=t.label,r=t.options,i=n(t,y);return h("div",null,a&&h("label",null,a),h("select",e({defaultValue:""},i),h("option",{disabled:!0,value:"",key:"__placehlder"},"Select..."),r.map(function(e,t){var a,n;return"object"==typeof e?(a=e.label,n=e.value):(a=e,n=e),h("option",{value:n,key:a+"_"+n+"_"+t},a)})))}var w=function(a){function r(e){var t;return(t=a.call(this,e)||this).getFileName=function(){return t.props.value?"data-url"===t.props.type?t.extractFileInfo(t.props.value).name:"file-url"===t.props.type?t.props.value:"Unknown file":""},t.extractFileInfo=function(e){var t=function(e){var t,a=e.split(","),n=a[0].split(";"),r=n[0].replace("data:",""),i=n.filter(function(e){return"name"===e.split("=")[0]});t=1!==i.length?"unknown":i[0].split("=")[1];for(var l=atob(a[1]),o=[],s=0;s<l.length;s++)o.push(l.charCodeAt(s));return{blob:new window.Blob([new Uint8Array(o)],{type:r}),name:t}}(e),a=t.blob;return{name:t.name,size:a.size,type:a.type}},t.addNameToDataURL=function(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")},t.handleChange=function(e){if("data-url"===t.props.type){var a=e.target.files[0],n=a.name,r=new FileReader;r.onload=function(){var e={target:{type:"text",value:t.addNameToDataURL(r.result,n),name:t.props.name}};t.props.onChange(e)},r.readAsDataURL(a)}else if("file-url"===t.props.type){var i=t.context.fileUploadEndpoint;if(!i)return console.error("Error: fileUploadEndpoint option need to be passed while initializing editor for enabling file uploads."),void alert("Files can't be uploaded.");t.setState({loading:!0});var l=new FormData;l.append("field_name",t.context.fieldName),l.append("model_name",t.context.modelName),l.append("coordinates",JSON.stringify(t.props.name.split("-").slice(1))),l.append("file",e.target.files[0]),fetch(i,{method:"POST",headers:{"X-CSRFToken":document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")}).length?document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")})[0].split("=")[1]:null},body:l}).then(function(e){return e.json()}).then(function(e){t.props.onChange({target:{type:"text",value:e.file_path,name:t.props.name}}),t.setState({loading:!1})}).catch(function(e){alert("Something went wrong while uploading file"),console.error("Error:",e),t.setState({loading:!1})})}},t.showFileBrowser=function(){t.inputRef.current.click()},t.state={value:e.value,fileName:t.getFileName(),loading:!1},t.inputRef=React.createRef(),t}t(r,a);var i=r.prototype;return i.componentDidUpdate=function(e,t){this.props.value!==e.value&&this.setState({value:this.props.value,fileName:this.getFileName()})},i.render=function(){var t=e({value:r},this.props),a=t.label,r=t.value,i=n(t,g);return i.type="file",i.onChange=this.handleChange,h("div",null,a&&h("label",null,a),h("div",{className:"rjf-file-field"},this.state.value&&h("div",{className:"rjf-current-file-name"},"Current file: ",h("span",null,this.state.fileName)),this.state.value&&!this.state.loading&&"Change:",this.state.loading?h("div",{className:"rjf-file-field-loading"},h(p,null)," Uploading..."):h("div",{className:"rjf-file-field-input"},h(b,e({},i,{inputRef:this.inputRef})))))},r}(React.Component);function O(e){return e.children?h("div",{className:"rjf-form-group-title"},e.children):null}function x(e){return h("div",{className:"rjf-form-row"},e.onRemove&&h(c,{className:"remove",onClick:function(t){return e.onRemove(name)},title:"Remove"},"×"),h("div",{className:"rjf-form-row-inner"},e.children))}function C(e){var t=React.Children.count(e.children),a=0!==e.level||t?"rjf-form-group-inner":"";return h("div",{className:"rjf-form-group"},0===e.level&&h(O,null,e.schema.title),h("div",{className:a},e.level>0&&h(O,null,e.schema.title),e.children,e.addable&&h(c,{className:"add",onClick:function(t){return e.onAdd()},title:"Add new"},t?"Add more":"Add")))}function _(t){var a,n={name:t.name,value:t.data},r=t.schema.type;switch(t.schema.choices&&(n.options=t.schema.choices,r="select"),t.schema.widget&&(r=t.schema.widget),r){case"string":a=b,t.schema.format?("data-url"!==t.schema.format&&"file-url"!==t.schema.format||(a=w),n.type=t.schema.format):n.type="text";break;case"number":case"integer":n.type="number",a=b;break;case"boolean":case"checkbox":n.type="checkbox",a=N;break;case"radio":n.type="radio",a=k;break;case"select":a=j;break;default:n.type="text",a=b}return h(a,e({},n,{label:t.editable?h("span",null,t.schema.title," ",h(c,{className:"edit",onClick:t.onEdit,title:"Edit"},"Edit")):t.schema.title,onChange:function(e){return function(e,t,a){var n;n="checkbox"===e.target.type?e.target.checked:e.target.value,"number"===t&&(""===(n=n.trim())||isNaN(Number(n))||(n=Number(n))),a(e.target.name,n)}(e,t.schema.type,t.onChange)}}))}function S(e,t,a,n,r,i,l,o){return h(x,{key:a,onRemove:i?function(e){return r(a)}:null},h(_,{data:e,schema:t,name:a,onChange:n,onEdit:l,editable:o}))}function R(e,t,a,n,r,i,o){var s=[],u=[],p=!0;e.length<=(t.min_items||0)&&(p=!1);var d=!0;e.length>=(t.max_items||100)&&(d=!1);for(var f=0;f<e.length;f++){var m=e[f],v=a+"-"+f;"array"===t.items.type?u.push(R(m,t.items,v,n,r,i,o+1)):"object"===t.items.type?u.push(I(m,t.items,v,n,r,i,o+1)):s.push(S(m,t.items,v,n,i,p))}var y=a;if((s.length||!s.length&&!u.length)&&(s=h(C,{level:o,schema:t,addable:d,onAdd:function(){return r(l(t.items),y)},key:"row_group_"+a},s)),u.length){var g=t.title?h("div",{className:"rjf-form-group-title"},t.title):null;u=h("div",{key:"group_"+a},g,u.map(function(e,t){return h("div",{className:"rjf-form-group-wrapper",key:"group_wrapper_"+a+"_"+t},p&&h(c,{className:"remove",onClick:function(e){return i(a+"-"+t)},title:"Remove"},"×"),e)}),d&&h(c,{className:"add",onClick:function(e){return r(l(t.items),y)},title:"Add new"},"Add item"))}return[].concat(s,u)}function I(e,t,a,n,r,i,l){var o=[],s=[].concat(Object.keys(t.keys));t.additionalProperties&&(s=[].concat(s,Object.keys(e).filter(function(e){return-1===s.indexOf(e)})));for(var u=function(u){var c=s[u],p=e[c],d=a+"-"+c,h=t.keys[c]||{type:"string"};h.title||(h.title=function(e){return null==e?"":(t=e=e.replace(/_/g," "))?t.charAt(0).toUpperCase()+t.substr(1).toLowerCase():"";var t}(c));var f=!1;void 0===t.keys[c]&&(f=!0),o.push("array"===h.type?R(p,h,d,n,r,i,l+1):"object"===h.type?I(p,h,d,n,r,i,l+1):S(p,h,d,n,i,f,function(){return F(e,c,p,d,r,i)},f))},c=0;c<s.length;c++)u(c);if(o.length||t.additionalProperties){var p=a;o=h(C,{level:l,schema:t,addable:t.additionalProperties,onAdd:function(){return function(e,t,a){var n=prompt("Add new key");null!==n&&((n=n.trim())?e.hasOwnProperty(n)?alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎"):a("",t+"-"+n):alert("(!) Can't add empty key.\r\n\r\n‎"))}(e,p,r)},key:"row_group_"+a},o)}return o}function F(e,t,a,n,r,i){var l=prompt("Rename key",t);if(null!==l&&(l=l.trim())!==t){if(!l)return alert("(!) Key name can't be empty.\r\n\r\n‎");if(e.hasOwnProperty(l))return alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎");r(a,name+"-"+l),i(n)}}w.contextType=d;var A=function(e){function a(t){var a;(a=e.call(this,t)||this).populateDataInput=function(){a.dataInput.value=JSON.stringify(a.state.data)},a.handleChange=function(e,t){(e=e.split("-")).shift();var n=JSON.parse(JSON.stringify(a.state.data));!function e(t,a,n){var r=t.shift();isNaN(Number(r))||(r=Number(r)),t.length?e(t,a[r],n):a[r]=n}(e,n,t),a.setState({data:n})},a.getFields=function(){var e=a.state.data,t=[];try{if("array"===a.schema.type)return R(e,a.schema,"rjf",a.handleChange,a.addFieldset,a.removeFieldset,0);if("object"===a.schema.type)return I(e,a.schema,"rjf",a.handleChange,a.addFieldset,a.removeFieldset,0)}catch(e){t=h("p",{style:{color:"#f00"}},h("strong",null,"(!) Error:")," Schema and data do not match.")}return t},a.addFieldset=function(e,t){(t=t.split("-")).shift(),a.setState(function(a){var n=JSON.parse(JSON.stringify(a.data));return function e(t,a,n){var r=t.shift();isNaN(Number(r))||(r=Number(r)),t.length?e(t,a[r],n):Array.isArray(a)?a.push(n):Array.isArray(a[r])?a[r].push(n):a[r]=n}(t,n,e),{data:n}})},a.removeFieldset=function(e){(e=e.split("-")).shift(),a.setState(function(t){var a=JSON.parse(JSON.stringify(t.data));return function e(t,a){var n=t.shift();isNaN(Number(n))||(n=Number(n)),t.length?e(t,a[n]):Array.isArray(a)?a=a.splice(n,1):delete a[n]}(e,a),{data:a}})},a.dataInput=document.getElementById(a.props.dataInputId),a.schema=t.schema;var n,r,i=t.data;if(i)try{n=i,i="array"===(r=a.schema).type?o(n,r):"object"===r.type?s(n,r):n}catch(e){console.log("Error: Schema and data don't match"),console.log(e)}else i=l(a.schema);return a.state={value:"",data:i},a.populateDataInput(),a}t(a,e);var n=a.prototype;return n.componentDidUpdate=function(e,t){this.state.data!==t.data&&this.populateDataInput()},n.render=function(){return h("div",{className:"rjf-form-wrapper"},h("fieldset",{className:"module aligned"},h(d.Provider,{value:{fileUploadEndpoint:this.props.fileUploadEndpoint,fieldName:this.props.fieldName,modelName:this.props.modelName}},this.getFields())))},a}(React.Component);return{JSONForm:function(e){this.containerId=e.containerId,this.dataInputId=e.dataInputId,this.schema=e.schema,this.data=e.data,this.fileUploadEndpoint=e.fileUploadEndpoint,this.fieldName=e.fieldName,this.modelName=e.modelName,this.render=function(){ReactDOM.render(h(A,{schema:this.schema,dataInputId:this.dataInputId,data:this.data,fileUploadEndpoint:this.fileUploadEndpoint,fieldName:this.fieldName,modelName:this.modelName}),document.getElementById(this.containerId))}}}});
//# sourceMappingURL=react-json-form.min.js.map
