!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).reactJsonForm=t()}(this,function(){function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(a=l[n])>=0||(r[a]=e[a]);return r}function r(e,t){var a={},n=e.keys||e.properties;for(var i in n){var o=n[i],c=o.hasOwnProperty("$ref");c&&(o=t(o.$ref));var s=o.type;"list"===s?s="array":"dict"===s&&(s="object"),a[i]="array"===s?c?[]:l(o,t):"object"===s?r(o,t):"boolean"===s?o.default||!1:"integer"===s||"number"===s?o.default||null:o.default||""}return a}function l(e,t){if(e.default)return e.default;var a=[];if(0===(e.minItems||e.min_items||0))return a;e.items.hasOwnProperty("$ref")&&(e.items=t(e.items.$ref));var n=e.items.type;return"list"===n?n="array":"dict"===n&&(n="object"),"array"===n?(a.push(l(e.items,t)),a):"object"===n?(a.push(r(e.items,t)),a):("multiselect"===e.items.widget||a.push("boolean"===n?e.items.default||!1:"integer"===n||"number"===n?e.items.default||null:e.items.default||""),a)}function i(e,t){e.hasOwnProperty("$ref")&&(e=t(e.$ref));var a=e.type;return"list"===a?a="array":"dict"===a&&(a="object"),"array"===a?l(e,t):"object"===a?r(e,t):"boolean"===a?e.default||!1:"integer"===a||"number"===a?e.default||null:e.default||""}function o(e,t,a){var n=JSON.parse(JSON.stringify(e));t.items.hasOwnProperty("$ref")&&(t.items=a(t.items.$ref));var r=t.items.type;"list"===r?r="array":"dict"===r&&(r="object");for(var l=0;l<e.length;l++){var i=e[l];"array"===r?n[l]=o(i,t.items,a):"object"===r?n[l]=c(i,t.items,a):"integer"!==r&&"number"!==r||""!==i||(n[l]=null)}return n}function c(e,t,a){for(var n=JSON.parse(JSON.stringify(e)),r=t.keys||t.properties,l=[].concat(Object.keys(r)),i=0;i<l.length;i++){var s=l[i],m=r[s];m.hasOwnProperty("$ref")&&(m=a(m.$ref));var p=m.type;"list"===p?p="array":"dict"===p&&(p="object"),n[s]=e.hasOwnProperty(s)?"array"===p?o(e[s],m,a):"object"===p?c(e[s],m,a):"integer"!==p&&"number"!==p||""!==e[s]?e[s]:null:"array"===p?o([],m,a):"object"===p?c({},m,a):"boolean"!==p&&("integer"===p||"number"===p?null:"")}return n}var s=["className"];function m(t){var a=t.className,r=n(t,s);a||(a="");var l=a.split(" ");a="";for(var i=0;i<l.length;i++)a=a+"rjf-"+l[i]+"-button ";return React.createElement("button",e({className:a.trim(),type:"button"},r),r.children)}function p(e){var t="rjf-loader";return e.className&&(t=t+" "+e.className),React.createElement("div",{className:t})}function d(e){var t;switch(e.name){case"chevron-up":t=React.createElement(u,null);break;case"chevron-down":t=React.createElement(f,null);break;case"arrow-down":t=React.createElement(h,null);break;case"x-lg":t=React.createElement(v,null)}return React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"rjf-icon rjf-icon-"+e.name,viewBox:"0 0 16 16"},t)}function u(e){return React.createElement("path",{fillRule:"evenodd",d:"M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"})}function f(e){return React.createElement("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}function h(e){return React.createElement("path",{"fill-rule":"evenodd",d:"M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"})}function v(e){return React.createElement("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"})}var g=function(e){function a(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).sendValue=function(e){t.props.onChange(e)},t.validateValue=function(e,t){return"hh"===e&&t<1?1:"hh"!==e&&t<0?0:"hh"===e&&t>12?12:"hh"!==e&&t>59?59:t},t.handleChange=function(e){var a,n=e.target.dataset.name,r=e.target.value;if(!isNaN(r)){var l=t.validateValue(n,parseInt(r)||0);"hh"!==n||"0"!==r&&""!==r&&"00"!==r||1!==l||(l=0),r.startsWith("0")&&l<10&&0!==l&&(l=l.toString().padStart(2,"0")),t.sendValue(((a={})[n]=""!==r?l.toString():"",a))}},t.handleKeyDown=function(e){var a;if(38===e.keyCode||40===e.keyCode){var n=e.target.dataset.name,r=parseInt(e.target.value)||0;38===e.keyCode?r++:40===e.keyCode&&r--,t.sendValue(((a={})[n]=t.validateValue(n,r).toString().padStart(2,"0"),a))}},t.handleSpin=function(e,a){var n,r=t.props[e];"ampm"===e?r="am"===r?"pm":"am":(r=parseInt(r)||0,"up"===a?r++:r--,r=t.validateValue(e,r).toString().padStart(2,"0")),t.sendValue(((n={})[e]=r,n))},t.handleBlur=function(e){var a,n=t.validateValue(e.target.dataset.name,parseInt(e.target.value)||0);n<10&&t.sendValue(((a={})[e.target.dataset.name]=n.toString().padStart(2,"0"),a))},t}t(a,e);var n=a.prototype;return n.componentWillUnmount=function(){var e={hh:this.validateValue("hh",this.props.hh).toString().padStart(2,"0"),mm:this.validateValue("mm",this.props.mm).toString().padStart(2,"0"),ss:this.validateValue("ss",this.props.ss).toString().padStart(2,"0")};this.sendValue(e)},n.render=function(){var e=this;return React.createElement("div",{className:"rjf-time-picker"},React.createElement("div",{className:"rjf-time-picker-row rjf-time-picker-labels"},React.createElement("div",{className:"rjf-time-picker-col"},"Hrs"),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},"Min"),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},"Sec"),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},"am/pm")),React.createElement("div",{className:"rjf-time-picker-row"},React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("hh","up")}},React.createElement(d,{name:"chevron-up"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("mm","up")}},React.createElement(d,{name:"chevron-up"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("ss","up")}},React.createElement(d,{name:"chevron-up"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("ampm","up")}},React.createElement(d,{name:"chevron-up"})))),React.createElement("div",{className:"rjf-time-picker-row rjf-time-picker-values"},React.createElement("div",{className:"rjf-time-picker-col"},React.createElement("input",{type:"text","data-name":"hh",value:this.props.hh,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"},":"),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement("input",{type:"text","data-name":"mm",value:this.props.mm,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"},":"),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement("input",{type:"text","data-name":"ss",value:this.props.ss,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},this.props.ampm)),React.createElement("div",{className:"rjf-time-picker-row"},React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("hh","down")}},React.createElement(d,{name:"chevron-down"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("mm","down")}},React.createElement(d,{name:"chevron-down"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("ss","down")}},React.createElement(d,{name:"chevron-down"}))),React.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),React.createElement("div",{className:"rjf-time-picker-col"},React.createElement(m,{onClick:function(){return e.handleSpin("ampm","down")}},React.createElement(d,{name:"chevron-down"})))))},a}(React.Component),R=React.createContext();function E(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}function y(){var e=document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")});if(e.length)return e[0].split("=")[1];var t=document.querySelector('input[name="csrfmiddlewaretoken"]');return t?t.value:null}var b=["label","help_text","error","inputRef"],N=["label","help_text","error","value"],k=["label","help_text","error","value","options"],j=["label","help_text","error","value","options"],w=["label","value"],C=["label","help_text","error","inputRef"];function S(e){var t=e.label,a=e.help_text,r=e.inputRef,l=n(e,b);return"string"===l.type&&(l.type="text"),r&&(l.ref=r),null===l.value&&(l.value=""),React.createElement("div",null,t&&React.createElement("label",null,t),React.createElement("div",{className:"rjf-input-group"},React.createElement("input",l),a&&React.createElement("span",{className:"rjf-help-text"},a)))}function _(e){var t=e.label,a=e.help_text,r=e.value,l=n(e,N);return t||(t=l.name.toUpperCase()),"bool"===l.type&&(l.type="checkbox"),void 0===l.checked&&(l.checked=r),""!==l.checked&&null!=l.checked||(l.checked=!1),l.readOnly&&(l.disabled=!0),React.createElement("div",{className:"rjf-check-input"},React.createElement("label",null,React.createElement("input",l)," ",t),a&&React.createElement("span",{className:"rjf-help-text"},a))}function x(t){var a=t.label,r=t.help_text,l=t.value,i=t.options,o=n(t,k);return o.readOnly&&(o.disabled=!0),React.createElement("div",{className:"rjf-check-input"},React.createElement("label",null,a),i.map(function(t,a){var n,r;return"object"==typeof t?(n=t.label,r=t.value):("boolean"==typeof(n=t)&&(n=E(n.toString())),r=t),React.createElement("label",{key:n+"_"+r+"_"+a},React.createElement("input",e({},o,{value:r,checked:r===l}))," ",n)}),r&&React.createElement("span",{className:"rjf-help-text"},r))}function O(t){var a=t.label,r=t.help_text,l=t.value,i=t.options,o=n(t,j);return o.readOnly&&(o.disabled=!0),React.createElement("div",null,a&&React.createElement("label",null,a),React.createElement("div",{className:"rjf-input-group"},React.createElement("select",e({value:l||""},o),React.createElement("option",{disabled:!0,value:"",key:"__placehlder"},"Select..."),i.map(function(e,t){var a,n;return"object"==typeof e?(a=e.label,n=e.value):("boolean"==typeof(a=e)&&(a=E(a.toString())),n=e),React.createElement("option",{value:n,key:a+"_"+n+"_"+t},a)})),r&&React.createElement("span",{className:"rjf-help-text"},r)))}var M=function(e){function a(t){var a;return(a=e.call(this,t)||this).handleChange=function(e){var t=[].concat(a.props.value);e.target.checked?t.push(e.target.value):t=t.filter(function(t){return t!==e.target.value}),a.props.onChange({target:{type:a.props.type,value:t,name:a.props.name}})},a.showOptions=function(e){a.state.showOptions||a.setState({showOptions:!0})},a.hideOptions=function(e){a.setState({showOptions:!1})},a.toggleOptions=function(e){a.setState(function(e){return{showOptions:!e.showOptions}})},a.state={showOptions:!1},a.optionsContainer=React.createRef(),a.input=React.createRef(),a}return t(a,e),a.prototype.render=function(){return React.createElement("div",{className:"rjf-multiselect-field"},React.createElement(S,{label:this.props.label,type:"text",value:this.props.value.length?this.props.value.length+" selected":"Select...",help_text:this.props.help_text,error:this.props.error,onClick:this.toggleOptions,readOnly:!0,inputRef:this.input,className:"rjf-multiselect-field-input"}),this.state.showOptions&&React.createElement(P,{options:this.props.options,value:this.props.value,hideOptions:this.hideOptions,onChange:this.handleChange,containerRef:this.optionsContainer,inputRef:this.input,disabled:this.props.readOnly,hasHelpText:this.props.help_text&&1}))},a}(React.Component),P=function(e){function a(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleClickOutside=function(e){!t.props.containerRef.current||t.props.containerRef.current.contains(e.target)||t.props.inputRef.current.contains(e.target)||t.props.hideOptions()},t}t(a,e);var n=a.prototype;return n.componentDidMount=function(){document.addEventListener("mousedown",this.handleClickOutside)},n.componentWillUnmount=function(){document.removeEventListener("mousedown",this.handleClickOutside)},n.render=function(){var e=this;return React.createElement("div",{ref:this.props.containerRef},React.createElement("div",{className:"rjf-multiselect-field-options-container",style:this.props.hasHelpText?{marginTop:"-15px"}:{}},this.props.options.map(function(t,a){var n,r;"object"==typeof t?(n=t.label,r=t.value):("boolean"==typeof(n=t)&&(n=E(n.toString())),r=t);var l=e.props.value.indexOf(r)>-1,i="rjf-multiselect-field-option";return l&&(i+=" selected"),e.props.disabled&&(i+=" disabled"),React.createElement("div",{key:n+"_"+r+"_"+a,className:i},React.createElement("label",null,React.createElement("input",{type:"checkbox",onChange:e.props.onChange,value:r,checked:l,disabled:e.props.disabled})," ",n))})))},a}(React.Component),D=function(a){function r(e){var t;return(t=a.call(this,e)||this).getFileName=function(){return t.props.value?"data-url"===t.props.type?t.extractFileInfo(t.props.value).name:"file-url"===t.props.type?t.props.value:"Unknown file":""},t.extractFileInfo=function(e){var t=function(e){var t,a=e.split(","),n=a[0].split(";"),r=n[0].replace("data:",""),l=n.filter(function(e){return"name"===e.split("=")[0]});t=1!==l.length?"unknown":l[0].split("=")[1];for(var i=atob(a[1]),o=[],c=0;c<i.length;c++)o.push(i.charCodeAt(c));return{blob:new window.Blob([new Uint8Array(o)],{type:r}),name:t}}(e),a=t.blob;return{name:t.name,size:a.size,type:a.type}},t.addNameToDataURL=function(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")},t.handleChange=function(e){if("data-url"===t.props.type){var a=e.target.files[0],n=a.name,r=new FileReader;r.onload=function(){var e={target:{type:"text",value:t.addNameToDataURL(r.result,n),name:t.props.name}};t.props.onChange(e)},r.readAsDataURL(a)}else if("file-url"===t.props.type){var l=t.context.fileUploadEndpoint;if(!l)return console.error("Error: fileUploadEndpoint option need to be passed while initializing editor for enabling file uploads."),void alert("Files can't be uploaded.");t.setState({loading:!0});var i=new FormData;i.append("field_name",t.context.fieldName),i.append("model_name",t.context.modelName),i.append("uid",t.context.uid),i.append("coordinates",JSON.stringify(t.props.name.split("-").slice(1))),i.append("file",e.target.files[0]),fetch(l,{method:"POST",headers:{"X-CSRFToken":y()},body:i}).then(function(e){return e.json()}).then(function(e){t.props.onChange({target:{type:"text",value:e.file_path,name:t.props.name}}),t.setState({loading:!1})}).catch(function(e){alert("Something went wrong while uploading file"),console.error("Error:",e),t.setState({loading:!1})})}},t.showFileBrowser=function(){t.inputRef.current.click()},t.clearFile=function(){window.confirm("Do you want to remove this file?")&&(t.props.onChange({target:{type:"text",value:"",name:t.props.name}}),t.inputRef.current&&(t.inputRef.current.value=""))},t.state={value:e.value,fileName:t.getFileName(),loading:!1},t.inputRef=React.createRef(),t}t(r,a);var l=r.prototype;return l.componentDidUpdate=function(e,t){this.props.value!==e.value&&this.setState({value:this.props.value,fileName:this.getFileName()})},l.render=function(){var t=e({value:r},this.props),a=t.label,r=t.value,l=n(t,w);return l.type="file",l.onChange=this.handleChange,l.readOnly&&(l.disabled=!0),React.createElement("div",null,a&&React.createElement("label",null,a),React.createElement("div",{className:"rjf-file-field"},this.state.value&&React.createElement("div",{className:"rjf-current-file-name"},"Current file: ",React.createElement("span",null,this.state.fileName)," "," ",React.createElement(m,{className:"remove-file",onClick:this.clearFile},"Clear")),this.state.value&&!this.state.loading&&"Change:",this.state.loading?React.createElement("div",{className:"rjf-file-field-loading"},React.createElement(p,null)," Uploading..."):React.createElement("div",{className:"rjf-file-field-input"},React.createElement(S,e({},l,{inputRef:this.inputRef})))))},r}(React.Component);D.contextType=R;var L=function(e){function a(t){var a;return(a=e.call(this,t)||this).handleChange=function(e){a.updateHeight(e.target),a.props.onChange&&a.props.onChange(e)},a.updateHeight=function(e){var t=e.offsetHeight-e.clientHeight;e.style.height="auto",e.style.height=e.scrollHeight+t+"px"},t.inputRef||(a.inputRef=React.createRef()),a}t(a,e);var r=a.prototype;return r.componentDidMount=function(){this.updateHeight(this.props.inputRef?this.props.inputRef.current:this.inputRef.current)},r.render=function(){var e=this.props,t=e.label,a=e.help_text,r=e.inputRef,l=n(e,C);return delete l.type,l.ref=r||this.inputRef,l.onChange=this.handleChange,React.createElement("div",null,t&&React.createElement("label",null,t),React.createElement("div",{className:"rjf-input-group"},React.createElement("textarea",l),a&&React.createElement("span",{className:"rjf-help-text"},a)))},a}(React.Component),T=function(a){function n(t){var n;return(n=a.call(this,t)||this).getStateFromProps=function(){var e="",t="12",a="00",r="00",l="000",i="am";if(n.props.value){var o=new Date(n.props.value);e=o.getFullYear().toString().padStart(2,"0")+"-"+(o.getMonth()+1).toString().padStart(2,"0")+"-"+o.getDate().toString().padStart(2,"0"),0===(t=o.getHours())?t=12:12===t?i="pm":t>12&&(t-=12,i="pm"),a=o.getMinutes(),r=o.getSeconds(),l=o.getMilliseconds(),t=t.toString().padStart(2,"0"),a=a.toString().padStart(2,"0"),r=r.toString().padStart(2,"0")}return{date:e,hh:t,mm:a,ss:r,ms:l,ampm:i}},n.handleClickOutside=function(e){n.state.showTimePicker&&(!n.timePickerContainer.current||n.timePickerContainer.current.contains(e.target)||n.timeInput.current.contains(e.target)||n.setState({showTimePicker:!1}))},n.sendValue=function(){var e={target:{type:"text",value:"",name:n.props.name}};if(""===n.state.date||null===n.state.date)return n.props.onChange(e);var t=parseInt(n.state.hh);0===t&&(t=NaN),"am"===n.state.ampm?12===t&&(t=0):"pm"===n.state.ampm&&12!==t&&(t+=12),t=t.toString().padStart(2,"0");var a=n.state.mm.padStart(2,"0"),r=n.state.ss.padStart(2,"0");try{var l=new Date(n.state.date+"T"+t+":"+a+":"+r+"."+n.state.ms);e.target.value=l.toISOString().replace("Z","+00:00")}catch(t){return n.props.onChange(e)}n.props.onChange(e)},n.handleDateChange=function(e){n.setState({date:e.target.value},n.sendValue)},n.handleTimeChange=function(t){n.setState(e({},t),n.sendValue)},n.showTimePicker=function(){n.setState({showTimePicker:!0})},n.state=e({},n.getStateFromProps(),{showTimePicker:!1}),n.timeInput=React.createRef(),n.timePickerContainer=React.createRef(),n}t(n,a);var r=n.prototype;return r.componentDidUpdate=function(t,a){if(t.value!==this.props.value&&""!==this.state.hh&&"0"!==this.state.hh&&"00"!==this.state.hh){var n=!1,r=this.getStateFromProps();for(var l in r)if(r[l]!==this.state[l]){n=!0;break}n&&this.setState(e({},r))}},r.componentDidMount=function(){document.addEventListener("mousedown",this.handleClickOutside)},r.componentWillUnmount=function(){document.removeEventListener("mousedown",this.handleClickOutside)},r.render=function(){return React.createElement("div",{className:"rjf-datetime-field"},this.props.label&&React.createElement("label",null,this.props.label),React.createElement("div",{className:"rjf-datetime-field-inner"},React.createElement("div",{className:"rjf-datetime-field-inputs"},React.createElement("div",{className:"rjf-datetime-field-date"},React.createElement(S,{label:"Date",type:"date",value:this.state.date,onChange:this.handleDateChange})),React.createElement("div",{className:"rjf-datetime-field-time"},React.createElement(S,{label:"Time",type:"text",value:this.state.hh+":"+this.state.mm+":"+this.state.ss+" "+this.state.ampm,onFocus:this.showTimePicker,readOnly:!0,inputRef:this.timeInput}),React.createElement("div",{ref:this.timePickerContainer},this.state.showTimePicker&&React.createElement(g,{onChange:this.handleTimeChange,hh:this.state.hh,mm:this.state.mm,ss:this.state.ss,ampm:this.state.ampm})))),this.props.help_text&&React.createElement("span",{className:"rjf-help-text"},this.props.help_text)))},n}(React.Component);function A(e){return e.children?React.createElement("div",{className:"rjf-form-group-title"},e.editable?React.createElement("span",null,e.children," ",React.createElement(m,{className:"edit",onClick:e.onEdit,title:"Edit"},"Edit")):e.children):null}function I(e,t,a){var n=e.target.parentElement.parentElement,r=n.previousElementSibling,l=n.nextElementSibling;if(n.classList.add("rjf-animate","rjf-"+t),"move-up"===t){var i=r.getBoundingClientRect().y,o=i,c=i=n.getBoundingClientRect().y;r.classList.add("rjf-animate"),r.style.opacity=0,r.style.transform="translateY("+(c-o)+"px)",n.style.opacity=0,n.style.transform="translateY(-"+(c-o)+"px)"}else if("move-down"===t){var s=n.getBoundingClientRect().y,m=s,p=s=l.getBoundingClientRect().y;l.classList.add("rjf-animate"),l.style.opacity=0,l.style.transform="translateY(-"+(p-m)+"px)",n.style.opacity=0,n.style.transform="translateY("+(p-m)+"px)"}setTimeout(function(){a(),n.classList.remove("rjf-animate","rjf-"+t),n.style=null,"move-up"===t?(r.classList.remove("rjf-animate"),r.style=null):"move-down"===t&&(l.classList.remove("rjf-animate"),l.style=null)},200)}function U(e){return React.createElement("div",{className:"rjf-form-row-controls"},e.onMoveUp&&React.createElement(m,{className:"move-up",onClick:function(t){return I(t,"move-up",e.onMoveUp)},title:"Move up"},React.createElement("span",null,"↑")),e.onMoveDown&&React.createElement(m,{className:"move-down",onClick:function(t){return I(t,"move-down",e.onMoveDown)},title:"Move down"},React.createElement("span",null,"↓")),e.onRemove&&React.createElement(m,{className:"remove",onClick:function(t){return I(t,"remove",e.onRemove)},title:"Remove"},React.createElement("span",null,"×")))}function F(e){return React.createElement("div",{className:"rjf-form-row"},React.createElement(U,e),React.createElement("div",{className:"rjf-form-row-inner"},e.children))}function V(e){var t=React.Children.count(e.children),a=0!==e.level||t?"rjf-form-group-inner":"";return React.createElement("div",{className:"rjf-form-group"},0===e.level&&React.createElement(A,{editable:e.editable,onEdit:e.onEdit},e.schema.title),React.createElement("div",{className:a},e.level>0&&React.createElement(A,{editable:e.editable,onEdit:e.onEdit},e.schema.title),e.children,e.addable&&React.createElement(m,{className:"add",onClick:function(t){return e.onAdd()},title:"object"===e.schema.type?"Add new key":"Add new item"},"object"===e.schema.type?"Add key":"Add item")))}var B=function(a){function n(e){var t;return(t=a.call(this,e)||this).openModal=function(e){t.setState({open:!0})},t.closeModal=function(e){t.setState({open:!1,pane:"upload"})},t.togglePane=function(e){t.setState({pane:e})},t.handleFileSelect=function(e){t.props.onChange({target:{type:"text",value:e,name:t.props.name}}),t.closeModal()},t.handleFileUpload=function(e){t.props.onChange(e),t.closeModal()},t.clearFile=function(){window.confirm("Do you want to remove this file?")&&t.props.onChange({target:{type:"text",value:"",name:t.props.name}})},t.state={value:e.value,loading:!1,open:!1,pane:"upload"},t.inputRef=React.createRef(),t}return t(n,a),n.prototype.render=function(){return this.context.fileListEndpoint?React.createElement("div",null,this.props.label&&React.createElement("label",null,this.props.label),React.createElement("div",{className:"rjf-file-field"},this.props.value&&React.createElement("div",{className:"rjf-current-file-name"},"Current file: ",React.createElement("span",null,this.props.value)," "," ",React.createElement(m,{className:"remove-file",onClick:this.clearFile},"Clear")),React.createElement(m,{onClick:this.openModal,className:"upload-modal__open"},this.props.value?"Change file":"Select file")),React.createElement(ReactModal,{isOpen:this.state.open,onRequestClose:this.closeModal,contentLabel:"Select file",portalClassName:"rjf-modal-portal",overlayClassName:"rjf-modal__overlay",className:"rjf-modal__dialog",bodyOpenClassName:"rjf-modal__main-body--open",closeTimeoutMS:150,ariaHideApp:!1},React.createElement("div",{className:"rjf-modal__content"},React.createElement("div",{className:"rjf-modal__header"},React.createElement(J,{onClick:this.togglePane,tabName:"upload",active:"upload"===this.state.pane},"Upload new")," ",React.createElement(J,{onClick:this.togglePane,tabName:"library",active:"library"===this.state.pane},"Choose from library"),React.createElement(m,{className:"modal__close",onClick:this.closeModal,title:"Close (Esc)"},React.createElement(d,{name:"x-lg"}))),React.createElement("div",{className:"rjf-modal__body"},"upload"===this.state.pane&&React.createElement($,e({},this.props,{onChange:this.handleFileUpload,label:"",value:"",help_text:""})),"library"===this.state.pane&&React.createElement(H,{fileListEndpoint:this.context.fileListEndpoint,endpointArgs:{field_name:this.context.fieldName,model_name:this.context.modelName,coordinates:JSON.stringify(this.props.name.split("-").slice(1)),uid:this.context.uid},onFileSelect:this.handleFileSelect})),React.createElement("div",{className:"rjf-modal__footer"},React.createElement(m,{className:"modal__footer-close",onClick:this.closeModal},"Cancel"))))):React.createElement(D,this.props)},n}(React.Component);function J(e){var t="rjf-upload-modal__tab-button";return e.active&&(t+=" rjf-upload-modal__tab-button--active"),React.createElement("button",{onClick:function(){return e.onClick(e.tabName)},className:t},e.children)}function $(e){return React.createElement("div",{class:"rjf-upload-modal__pane"},React.createElement("h3",null,"Upload new"),React.createElement("br",null),React.createElement(D,e))}B.contextType=R;var H=function(a){function n(t){var n;return(n=a.call(this,t)||this).fetchList=function(){var t=n.props.fileListEndpoint;if(!t)return console.error("Error: fileListEndpoint option need to be passed while initializing editor for enabling file listing."),void n.setState({loading:!1,hasMore:!1});var a=t+"?"+new URLSearchParams(e({},n.props.endpointArgs,{page:n.state.page+1}));fetch(a,{method:"GET"}).then(function(e){return e.json()}).then(function(e){Array.isArray(e.file_list)||(e.file_list=[]),n.setState(function(t){return{loading:!1,files:[].concat(t.files,e.file_list),page:e.file_list.length>0?t.page+1:t.page,hasMore:e.file_list.length>0}})}).catch(function(e){alert("Something went wrong while retrieving media files"),console.error("Error:",e),n.setState({loading:!1})})},n.onLoadMore=function(e){n.setState({loading:!0},n.fetchList)},n.state={loading:!0,files:[],page:0,hasMore:!0},n}t(n,a);var r=n.prototype;return r.componentDidMount=function(){this.fetchList()},r.render=function(){var t=this;return React.createElement("div",{className:"rjf-upload-modal__pane"},React.createElement("h3",null,"Media library"),React.createElement("div",{className:"rjf-upload-modal__media-container"},this.state.files.map(function(a){return React.createElement(z,e({},a,{onClick:t.props.onFileSelect}))})),this.state.loading&&React.createElement(p,{className:"rjf-upload-modal__media-loader"}),!this.state.loading&&this.state.hasMore&&React.createElement("div",null,React.createElement(m,{onClick:this.onLoadMore,className:"upload-modal__media-load"},React.createElement(d,{name:"arrow-down"})," View more")),!this.state.hasMore&&React.createElement("div",{className:"rjf-upload-modal__media-end-message"},this.state.files.length?"End of list":"No files found"))},n}(React.Component);function z(e){var t=e.metadata||{};return React.createElement("div",{className:"rjf-upload-modal__media-tile"},React.createElement("div",{className:"rjf-upload-modal__media-tile-inner",tabIndex:"0",onClick:function(){return e.onClick(e.value)}},React.createElement("img",{src:e.thumbnail?e.thumbnail:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%23999999' class='bi bi-file-earmark' viewBox='0 0 16 16'%3E%3Cpath d='M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z'/%3E%3C/svg%3E"}),e.metadata&&React.createElement("div",{className:"rjf-upload-modal__media-tile-metadata"},Object.getOwnPropertyNames(t).map(function(e){return React.createElement("span",null,t[e])}))))}var K=["data","schema","name","onChange","onRemove","removable","onEdit","editable","onMoveUp","onMoveDown","parentType"];function Y(t){var a={name:t.name,value:t.data,readOnly:t.schema.readOnly||t.schema.readonly,help_text:t.schema.help_text||t.schema.helpText};t.schema.placeholder&&(a.placeholder=t.schema.placeholder);var n,r=t.schema.type,l=t.schema.choices||t.schema.enum;switch(l&&(a.options=l,r="select"),t.schema.widget&&("multiselect"===t.schema.widget&&"array"!==t.parentType||(r=t.schema.widget)),r){case"string":n=S,t.schema.format?("data-url"===t.schema.format?n=D:"file-url"===t.schema.format?n=B:"datetime"===t.schema.format&&(n=T),a.type=t.schema.format):a.type="text";break;case"number":a.type="number",n=S;break;case"integer":a.type="number",a.step="1",n=S;break;case"boolean":case"checkbox":a.type="checkbox",n=_;break;case"radio":a.type="radio",n=x;break;case"select":n=O;break;case"multiselect":n=M;break;case"textarea":n=L;break;default:a.type="text",n=S}return React.createElement(n,e({},a,{label:t.editable?React.createElement("span",null,t.schema.title," ",React.createElement(m,{className:"edit",onClick:t.onEdit,title:"Edit"},"Edit")):t.schema.title,onChange:function(e){return function(e,t,a){var n;n="checkbox"===e.target.type?e.target.checked:e.target.value,"number"===t||"integer"===t?""===(n=n.trim())?n=null:isNaN(Number(n))||(n=Number(n)):"boolean"===t&&(n="false"!==n&&!1!==n),a(e.target.name,n)}(e,t.schema.type,t.onChange)}}))}function W(t){var a=t.data,r=t.schema,l=t.name,i=t.onChange,o=t.onRemove,c=t.removable,s=t.onEdit,m=t.editable,p=t.onMoveUp,d=t.onMoveDown,u=t.parentType,f=n(t,K);return React.createElement(F,{key:l,onRemove:c?function(e){return o(l)}:null,onMoveUp:p,onMoveDown:d},React.createElement(Y,e({data:a,schema:r,name:l,onChange:i,onEdit:s,editable:m,parentType:u},f)))}function q(e){var t=e.data,a=e.schema,n=e.name,r=e.onChange,l=e.onAdd,o=e.onRemove,c=e.onMove,s=e.level,p=[],d=[],u=!0;t.length<=(a.min_items||a.minItems||0)&&(u=!1);var f=!0;t.length>=(a.max_items||a.maxItems||100)&&(f=!1),a.items.hasOwnProperty("$ref")&&(a.items=e.getRef(a.items.$ref));var h=a.items.type;"list"===h?h="array":"dict"===h&&(h="object");var v={schema:a.items,onChange:r,onAdd:l,onRemove:o,level:s+1,removable:u,onMove:c,parentType:"array",getRef:e.getRef};if("multiselect"===v.schema.widget)v.data=t,v.name=n,v.removable=!1,v.onMoveUp=null,v.onMoveDown=null,f=!1,p.push(W(v));else for(var g=function(e){v.data=t[e],v.name=n+"-"+e,v.onMoveUp=0===e?null:function(t){return c(n+"-"+e,n+"-"+(e-1))},v.onMoveDown=e===t.length-1?null:function(t){return c(n+"-"+e,n+"-"+(e+1))},"array"===h?d.push(q(v)):"object"===h?d.push(Z(v)):p.push(W(v))},R=0;R<t.length;R++)g(R);var E=n;if((p.length||!p.length&&!d.length)&&(p=React.createElement(V,{level:s,schema:a,addable:f,onAdd:function(){return l(i(a.items,e.getRef),E)},editable:e.editable,onEdit:e.onEdit,key:"row_group_"+n},p),"object"===e.parentType&&e.removable&&(p=React.createElement("div",{className:"rjf-form-group-wrapper",key:"row_group_wrapper_"+n},React.createElement(U,{onRemove:function(e){return o(n)}}),p))),d.length){var y=a.title?React.createElement(A,{editable:e.editable,onEdit:e.onEdit},a.title):null;d=React.createElement("div",{key:"group_"+n,className:"rjf-form-group-wrapper"},"object"===e.parentType&&e.removable&&React.createElement(U,{onRemove:function(e){return o(n)}}),React.createElement("div",{className:"rjf-form-group"},React.createElement("div",{className:s>0?"rjf-form-group-inner":""},y,d.map(function(e,t){return React.createElement("div",{className:"rjf-form-group-wrapper",key:"group_wrapper_"+n+"_"+t},React.createElement(U,{onRemove:u?function(e){return o(n+"-"+t)}:null,onMoveUp:t>0?function(e){return c(n+"-"+t,n+"-"+(t-1))}:null,onMoveDown:t<d.length-1?function(e){return c(n+"-"+t,n+"-"+(t+1))}:null}),e)}),f&&React.createElement(m,{className:"add",onClick:function(t){return l(i(a.items,e.getRef),E)},title:"Add new item"},"Add item"))))}return[].concat(p,d)}function Z(t){var a=t.data,n=t.schema,r=t.name,l=t.onChange,o=t.onAdd,c=t.onRemove,s=t.level,m=t.onMove,p=[],d=n.keys||n.properties,u=[].concat(Object.keys(d));n.additionalProperties&&(u=[].concat(u,Object.keys(a).filter(function(e){return-1===u.indexOf(e)})));for(var f=function(i){var f=u[i],h=a[f],v=r+"-"+f,g=d[f];void 0===g&&(g="boolean"==typeof n.additionalProperties?{type:"string"}:e({},n.additionalProperties));var R=g.hasOwnProperty("$ref");R&&(g=t.getRef(g.$ref));var y=g.type;"list"===y?y="array":"dict"===y&&(y="object"),(!g.title||R&&n.additionalProperties)&&(g.title=function(e){return null==e?"":E(e=e.replace(/_/g," "))}(f));var b=!1;void 0===d[f]&&(b=!0);var N={data:h,schema:g,name:v,onChange:l,onAdd:o,onRemove:c,level:s+1,removable:b,onMove:m,parentType:"object",getRef:t.getRef,onEdit:function(){return function(e,t,a,n,r,l){var i=prompt("Rename key",t);if(null!==i&&(i=i.trim())!==t){if(!i)return alert("(!) Key name can't be empty.\r\n\r\n‎");if(e.hasOwnProperty(i))return alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎");var o=n.split("-");o.pop(),o.push(i),r(a,o=o.join("-")),l(n)}}(a,f,h,v,o,c)}};N.editable=b,p.push("array"===y?q(N):"object"===y?Z(N):W(N))},h=0;h<u.length;h++)f(h);if(p.length||n.additionalProperties){var v=r;p=React.createElement(V,{level:s,schema:n,addable:n.additionalProperties,onAdd:function(){return function(e,t,a,n,r){var l=prompt("Add new key");null!==l&&(!0===n&&(n={type:"string"}),(l=l.trim())?e.hasOwnProperty(l)?alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎"):a(i(n,r),t+"-"+l):alert("(!) Can't add empty key.\r\n\r\n‎"))}(a,v,o,n.additionalProperties,t.getRef)},editable:t.editable,onEdit:t.onEdit,key:"row_group_"+r},p),"object"===t.parentType&&t.removable&&(p=React.createElement("div",{className:"rjf-form-group-wrapper",key:"row_group_wrapper_"+r},React.createElement(U,{onRemove:function(e){return c(r)}}),p))}return p}var G=function(a){function n(t){var n;(n=a.call(this,t)||this).populateDataInput=function(){n.dataInput.value=JSON.stringify(n.state.data)},n.handleChange=function(e,t){(e=e.split("-")).shift();var a=JSON.parse(JSON.stringify(n.state.data));!function e(t,a,n){var r=t.shift();isNaN(Number(r))||(r=Number(r)),t.length?e(t,a[r],n):a[r]=n}(e,a,t),n.setState({data:a})},n.getRef=function(t){for(var a,r=t.split("/"),l=0;l<r.length;l++){var i=r[l];a="#"===i?n.schema:a[i]}return e({},a)},n.getFields=function(){var e=n.state.data,t=[];try{var a=n.schema.type;"list"===a?a="array":"dict"===a&&(a="object");var r={data:e,schema:n.schema,name:"rjf",onChange:n.handleChange,onAdd:n.addFieldset,onRemove:n.removeFieldset,onMove:n.moveFieldset,level:0,getRef:n.getRef};if("array"===a)return q(r);if("object"===a)return Z(r)}catch(e){t=React.createElement("p",{style:{color:"#f00"}},React.createElement("strong",null,"(!) Error:")," Schema and data structure do not match.")}return t},n.addFieldset=function(e,t){(t=t.split("-")).shift(),n.setState(function(a){var n=JSON.parse(JSON.stringify(a.data));return X(t,n,e),{data:n}})},n.removeFieldset=function(e){(e=e.split("-")).shift(),n.setState(function(t){var a=JSON.parse(JSON.stringify(t.data));return Q(e,a),{data:a}})},n.moveFieldset=function(e,t){(e=e.split("-")).shift(),(t=t.split("-")).shift(),n.setState(function(a){var n=JSON.parse(JSON.stringify(a.data));return ee(e,t,n),{data:n}})},n.dataInput=document.getElementById(n.props.dataInputId),n.schema=t.schema;var r=t.data;if(r)try{r=function(e,t,a){t.hasOwnProperty("$ref")&&(t=a(t.$ref));var n=t.type;return"list"===n?n="array":"dict"===n&&(n="object"),"array"===n?o(e,t,a):"object"===n?c(e,t,a):e}(r,n.schema,n.getRef)}catch(e){console.error("Error: Schema and data structure don't match"),console.error(e)}else r=i(n.schema,n.getRef);return n.state={value:"",data:r},n.populateDataInput(),n}t(n,a);var r=n.prototype;return r.componentDidUpdate=function(e,t){this.state.data!==t.data&&this.populateDataInput()},r.render=function(){return React.createElement("div",{className:"rjf-form-wrapper"},React.createElement("fieldset",{className:"module aligned"},React.createElement(R.Provider,{value:{fileUploadEndpoint:this.props.fileUploadEndpoint,fileListEndpoint:this.props.fileListEndpoint,fieldName:this.props.fieldName,modelName:this.props.modelName,uid:this.props.uid}},this.getFields())))},n}(React.Component);function X(e,t,a){var n=e.shift();isNaN(Number(n))||(n=Number(n)),e.length?X(e,t[n],a):Array.isArray(t[n])?t[n].push(a):Array.isArray(t)?t.push(a):t[n]=a}function Q(e,t){var a=e.shift();isNaN(Number(a))||(a=Number(a)),e.length?Q(e,t[a]):Array.isArray(t)?t.splice(a,1):delete t[a]}function ee(e,t,a){var n=e.shift();if(isNaN(Number(n))||(n=Number(n)),e.length)ee(e,t,a[n]);else if(Array.isArray(a)){var r=t[t.length-1],l=a[n];a.splice(n,1),a.splice(r,0,l)}}return{JSONForm:function(e){this.containerId=e.containerId,this.dataInputId=e.dataInputId,this.schema=e.schema,this.data=e.data,this.fileUploadEndpoint=e.fileUploadEndpoint,this.fileListEndpoint=e.fileListEndpoint,this.fieldName=e.fieldName,this.modelName=e.modelName,this.uid=e.uid,this.render=function(){ReactDOM.render(React.createElement(G,{schema:this.schema,dataInputId:this.dataInputId,data:this.data,fileUploadEndpoint:this.fileUploadEndpoint,fileListEndpoint:this.fileListEndpoint,fieldName:this.fieldName,modelName:this.modelName,uid:this.uid}),document.getElementById(this.containerId))}}}});
//# sourceMappingURL=react-json-form.min.js.map
